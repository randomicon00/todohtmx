<!DOCTYPE html>
<html>
    <head>
        <title>Chat</title>
        <script src="https://unpkg.com/htmx.org@2.0.2"></script>
    </head>
    <body>
        <div id="chat-section" hx-get="/api/chat" hx-trigger="load" hx-swap="outerHTML">
            <div id="chat-container">
                <!-- Chat messages will be displayed here -->
            </div>
        </div>

        <input type="text" id="message-input" placeholder="Write a message...">
        <button onclick="sendMessage()">Send</button>

        <script>
            const chatSocket = new WebSocket(
                'ws://' + window.location.host + '/ws/chat/' + 'room_name' + '/'
            );
            
            chatSocket.onmessage = function(e) {
                const data = JSON.parse(e.data);
                const chatContainer = document.getElementById('chat-container');
                const newMessage = document.createElement('div');
                newMessage.innerHTML = data.message;
                chatContainer.appendChild(newMessage);
            };

            function sendMessage() {
                const messageInput = document.querySelector('#message-input');
                const message = messageInput.value;
                chatSocket.send(JSON.stringify({
                    'message': message
                }));
                messageInput.value = '';
            }
        </script>
    </body>
</html>
